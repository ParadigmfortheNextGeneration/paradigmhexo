var cheerio   = require('cheerio');
var fs        = require('fs');
var urlparser = require('url');

module.exports = function(page) {
  
  //var $ = cheerio.load(content);
  var config = this.config;
  var after_items = [];
  
  if (page.after_items_disable != true) {
    if (config.after_content) {
      after_items = config.after_content;
    }
    if (page.after_content) {
      after_items = page.after_content;
    }
  }
  
  var after_content = '';
  if (after_items) {
    if (after_items.length > 0) {
      for (i = 0; i < after_items.length; i++) {
        
        var parsed = urlparser.parse(after_items[i]);
        
        if (parsed.path && !parsed.hostname) {
          var path_array = parsed.path.split("/");
          
          path_array.shift()
          path_to_html = path_array.join('/');
          var file_contents = fs.readFileSync(__dirname + "/../../../source/" + path_to_html, 'utf8');
          //console.log(file_contents);
          after_content = file_contents + after_content;
          
        }
      }
    }
  }
  
  
  //console.log(after_items);
  return after_content;
  
  // $('a').each(function(index, element) {
  //  // This has to be done after the ajax injection, otherwise paragraphs inside can be injected.
  //  var href = $(element).attr('href');
  //      if (href) {
  //        var parsed = urlparser.parse(href);
  //        if (parsed.path && !parsed.hostname) {
  //          var path_array = parsed.path.split("/");
  //          if (path_array[1] == 'html') {
  //            path_array.shift()
  //            path_to_html = path_array.join('/');
  //            // /Users/Pongovi/Sites/scghexo/node_modules/hexo-html-injection/lib
  //            // TODO: Inject link to html page? account for pages that have layout: false
  //            var file_contents = fs.readFileSync(__dirname + "/../../../source/" + path_to_html, 'utf8');
  //            $(this).replaceWith(file_contents);
  //          }
  //        }
  //      }
  //  });
  //
  //content = $.html();
  //return content;
    
};